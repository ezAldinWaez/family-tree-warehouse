services:
  neo4j:
    image: neo4j:5.26
    container_name: family_tree_neo4j
    ports:
      - "7474:7474"
      - "7687:7687"
    environment:
      NEO4J_AUTH: neo4j/neo4j_password
    volumes:
      - ./demo_family_tree:/seed

  airflow:
    build:
      context: .
      dockerfile: docker/airflow/Dockerfile
    container_name: family_tree_airflow
    depends_on:
      - neo4j
    ports:
      - "8080:8080"
    environment:
      AIRFLOW__CORE__EXECUTOR: SequentialExecutor
      AIRFLOW__DATABASE__SQL_ALCHEMY_CONN: sqlite:////opt/airflow/airflow.db
      AIRFLOW__CORE__LOAD_EXAMPLES: "False"
      AIRFLOW__CORE__DAGS_ARE_PAUSED_AT_CREATION: "True"
      AIRFLOW__WEBSERVER__EXPOSE_CONFIG: "True"
      PYTHONPATH: /opt/project/src
      NEO4J_URI: bolt://neo4j:7687
      NEO4J_USER: neo4j
      NEO4J_PASSWORD: neo4j_password
      DUCKDB_PATH: /opt/project/warehouse/family_tree.duckdb
    volumes:
      - .:/opt/project
      - ./dags:/opt/airflow/dags
    command: ["bash", "/opt/project/docker/airflow/init_and_start.sh"]
